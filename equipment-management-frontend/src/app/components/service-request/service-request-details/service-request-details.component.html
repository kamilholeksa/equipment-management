<div class="row">
  <div class="col-md-4">
    <div class="px-3 pb-4 pt-2 mt-2 mat-elevation-z8">
      <h5 class="mb-5 mt-2">Zgłoszenie #{{ this.serviceRequest.id }}</h5>

      <form [formGroup]="serviceRequestForm" class="d-flex flex-column">
        <div>
          <p class="mb-0">Temat:</p>
          <p class="fw-medium mb-0">{{ serviceRequest.title }}</p>
        </div>
        <hr/>

        <div class="mb-2">
          <p class="mb-0">Opis:</p>
          <p class="fw-medium mb-0">{{ serviceRequest.description }}</p>
        </div>
        <hr/>

        <div class="mb-2">
          <p class="mb-0">Status:</p>
          <p class="fw-medium mb-0">{{ serviceRequest.status | serviceRequestStatusDisplay }}</p>
        </div>
        <div *ngIf="serviceRequest.status === ServiceRequestStatusEnum.CLOSED" class="mb-2">
          <p class="mb-0">Informacja o zamknięciu:</p>
          <p class="fw-medium mb-0">{{ serviceRequest.closeInfo }}</p>
        </div>
        <hr/>

        <div class="mb-2">
          <p class="mb-0">Sprzęt:</p>
          <p class="fw-medium mb-0">{{ serviceRequest.equipment.manufacturer + ' ' + serviceRequest.equipment.model + ' (' + serviceRequest.equipment.inventoryNumber + ')' }}
            <a routerLink="/equipment/{{ serviceRequest.equipment.id }}" class="p-1">
              <i class="bi bi-search"></i>
            </a>
          </p>
        </div>
        <hr/>

        <div class="mb-2">
          <p class="mb-0">Zgłaszający:</p>
          <p class="fw-medium mb-0">{{ serviceRequest.user.firstName + ' ' + serviceRequest.user.lastName }}</p>
        </div>
        <hr/>

        <div class="mb-2">
          <p class="mb-0">Przypisane do:</p>
          <p class="fw-medium">{{serviceRequest.technician ? serviceRequest.technician.firstName + ' ' + serviceRequest.technician.lastName : '' }}</p>
        </div>

        <div class="d-flex justify-content-between mt-5">
          <div class="d-flex flex-column">
            <button class="mt-auto" mat-flat-button (click)="goBack()">
              <i class="bi bi-arrow-left"></i>
              Wróć
            </button>
          </div>
          <div class="d-flex flex-md-column">
            <button *ngIf="serviceRequest.status === ServiceRequestStatusEnum.NEW" mat-stroked-button (click)="accept()">
              <i class="bi bi-check-lg"></i>
              Zaakceptuj zgłoszenie
            </button>
            <button *ngIf="serviceRequest.status === ServiceRequestStatusEnum.ACCEPTED || serviceRequest.status === ServiceRequestStatusEnum.IN_PROGRESS" mat-stroked-button (click)="changeAssignment()" class="mb-1">
              <i class="bi bi-person"></i>
              Przypisz technika
            </button>
            <button *ngIf="serviceRequest.status === ServiceRequestStatusEnum.ACCEPTED || serviceRequest.status === ServiceRequestStatusEnum.IN_PROGRESS" mat-stroked-button (click)="close()">
              <i class="bi bi-clipboard-check"></i>
              Zamknij zgłoszenie
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="col-md-8 d-flex flex-column">
    <h5 class="m-0 mt-2">Przebieg zgłoszenia</h5>

    <div class="flex-grow-1 overflow-auto px-2 py-4">
      <app-service-request-note-list [serviceRequestId]="serviceRequest.id"></app-service-request-note-list>
    </div>

    <div class="p-2 mt-1">
      <form [formGroup]="noteForm">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Dodaj nową notatkę</mat-label>
          <textarea matInput formControlName="description"></textarea>
        </mat-form-field>
        <div class="d-flex justify-content-end mt-2">
          <button mat-flat-button (click)="saveNote()" [disabled]="!this.noteForm.valid">Dodaj</button>
        </div>
      </form>
    </div>
  </div>
</div>
